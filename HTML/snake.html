<!DOCTYPE html>
<html lang="id" class="light">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no"
    />
    <title>Modern Snake Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg-color: #f3f4f6;
        --card-bg-color: #ffffff;
        --text-color: #1f2937;
        --text-secondary-color: #6b7280;
        --border-color: #e5e7eb;
        --snake-head-color: #2563eb;
        --snake-body-color: #3b82f6;
        --food-color: #ef4444;
        --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);
      }

      html.dark {
        --bg-color: #111827;
        --card-bg-color: #1f2937;
        --text-color: #f9fafb;
        --text-secondary-color: #9ca3af;
        --border-color: #374151;
        --snake-head-color: #60a5fa;
        --snake-body-color: #3b82f6;
        --food-color: #f87171;
        --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2),
          0 4px 6px -2px rgba(0, 0, 0, 0.15);
      }

      body {
        font-family: "Poppins", sans-serif;
        background-color: var(--bg-color);
        color: var(--text-color);
        transition: background-color 0.3s, color 0.3s;
        touch-action: manipulation;
      }

      #game-board {
        background-color: var(--bg-color);
        cursor: pointer;
        border-radius: 0.75rem;
        border: 1px solid var(--border-color);
      }

      .modal-overlay {
        background-color: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(5px);
      }
    </style>
  </head>
  <body
    class="flex flex-col items-center justify-center min-h-screen p-4 overflow-hidden"
  >
    <div class="w-full max-w-md mx-auto">
      <!-- Header: Skor dan Tombol Tema -->
      <header class="flex justify-between items-center mb-4">
        <div class="text-left">
          <h1
            class="text-2xl font-bold tracking-tight"
            style="color: var(--text-color)"
          >
            Snake
          </h1>
          <p class="text-sm" style="color: var(--text-secondary-color)">
            Skor: <span id="current-score" class="font-bold">0</span>
          </p>
        </div>
        <div class="text-right">
          <p class="text-sm font-bold" style="color: var(--text-color)">
            SKOR TERTINGGI
          </p>
          <p
            id="high-score"
            class="text-lg font-bold"
            style="color: var(--text-secondary-color)"
          >
            0
          </p>
        </div>
      </header>

      <!-- Papan Permainan -->
      <div
        class="relative w-full aspect-square"
        style="box-shadow: var(--shadow); border-radius: 0.75rem"
      >
        <canvas id="game-board" class="w-full h-full"></canvas>
        <!-- Modal Game Over -->
        <div
          id="game-over-modal"
          class="absolute inset-0 z-10 flex-col items-center justify-center p-4 transition-opacity duration-300 bg-black bg-opacity-50 backdrop-blur-sm rounded-xl opacity-0 pointer-events-none hidden"
        >
          <div class="text-center text-white">
            <h2 class="text-4xl font-bold">Game Over</h2>
            <p class="mt-2 mb-6">
              Skor akhirmu adalah
              <span id="final-score" class="font-bold">0</span>
            </p>
            <button
              id="restart-button"
              class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg text-lg transition-transform transform hover:scale-105"
            >
              Main Lagi
            </button>
          </div>
        </div>
      </div>

      <!-- Kontrol Mobile -->
      <div class="grid grid-cols-3 grid-rows-2 gap-3 mt-4 md:hidden">
        <div></div>
        <button
          data-direction="up"
          class="control-btn bg-white dark:bg-gray-700 p-4 rounded-lg"
          style="box-shadow: var(--shadow)"
        >
          &#8593;
        </button>
        <div></div>
        <button
          data-direction="left"
          class="control-btn bg-white dark:bg-gray-700 p-4 rounded-lg"
          style="box-shadow: var(--shadow)"
        >
          &#8592;
        </button>
        <button
          data-direction="down"
          class="control-btn bg-white dark:bg-gray-700 p-4 rounded-lg"
          style="box-shadow: var(--shadow)"
        >
          &#8595;
        </button>
        <button
          data-direction="right"
          class="control-btn bg-white dark:bg-gray-700 p-4 rounded-lg"
          style="box-shadow: var(--shadow)"
        >
          &#8594;
        </button>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const canvas = document.getElementById("game-board");
        const ctx = canvas.getContext("2d");

        const currentScoreEl = document.getElementById("current-score");
        const highScoreEl = document.getElementById("high-score");
        const gameOverModal = document.getElementById("game-over-modal");
        const finalScoreEl = document.getElementById("final-score");
        const restartButton = document.getElementById("restart-button");

        const gridSize = 20;
        let canvasSize;

        let snake, food, score, highScore, direction, gameLoop, gameActive;

        const initGame = () => {
          snake = [{ x: 10, y: 10 }];
          food = {};
          score = 0;
          highScore = localStorage.getItem("snakeHighScore") || 0;
          direction = "right";
          gameActive = true;

          currentScoreEl.textContent = score;
          highScoreEl.textContent = highScore;

          gameOverModal.classList.add(
            "opacity-0",
            "pointer-events-none",
            "hidden"
          );

          placeFood();
          if (gameLoop) clearInterval(gameLoop);
          gameLoop = setInterval(main, 100);
        };

        const resizeCanvas = () => {
          const container = canvas.parentElement;
          const size = Math.min(container.clientWidth, container.clientHeight);
          canvas.width = size;
          canvas.height = size;
          canvasSize = size;
        };

        const placeFood = () => {
          food = {
            x: Math.floor(Math.random() * (canvas.width / gridSize)),
            y: Math.floor(Math.random() * (canvas.height / gridSize)),
          };
        };

        const draw = () => {
          ctx.clearRect(0, 0, canvas.width, canvas.height);

          // Draw snake
          snake.forEach((segment, index) => {
            ctx.fillStyle =
              index === 0
                ? "var(--snake-head-color)"
                : "var(--snake-body-color)";
            ctx.fillRect(
              segment.x * gridSize,
              segment.y * gridSize,
              gridSize,
              gridSize
            );
            ctx.strokeStyle = "var(--bg-color)";
            ctx.strokeRect(
              segment.x * gridSize,
              segment.y * gridSize,
              gridSize,
              gridSize
            );
          });

          // Draw food
          ctx.fillStyle = "var(--food-color)";
          ctx.fillRect(
            food.x * gridSize,
            food.y * gridSize,
            gridSize,
            gridSize
          );
        };

        const update = () => {
          if (!gameActive) return;

          const head = { ...snake[0] };
          if (direction === "up") head.y--;
          if (direction === "down") head.y++;
          if (direction === "left") head.x--;
          if (direction === "right") head.x++;

          snake.unshift(head);

          // Check for collision with food
          if (head.x === food.x && head.y === food.y) {
            score++;
            currentScoreEl.textContent = score;
            placeFood();
          } else {
            snake.pop();
          }

          // Check for collision with walls or self
          if (
            head.x < 0 ||
            head.x >= canvas.width / gridSize ||
            head.y < 0 ||
            head.y >= canvas.height / gridSize ||
            checkSelfCollision()
          ) {
            gameOver();
          }
        };

        const checkSelfCollision = () => {
          const head = snake[0];
          for (let i = 1; i < snake.length; i++) {
            if (head.x === snake[i].x && head.y === snake[i].y) {
              return true;
            }
          }
          return false;
        };

        const gameOver = () => {
          gameActive = false;
          clearInterval(gameLoop);

          if (score > highScore) {
            highScore = score;
            localStorage.setItem("snakeHighScore", highScore);
            highScoreEl.textContent = highScore;
          }

          finalScoreEl.textContent = score;
          gameOverModal.classList.remove("hidden");
          setTimeout(() => {
            gameOverModal.classList.remove("opacity-0", "pointer-events-none");
          }, 10);
        };

        const main = () => {
          update();
          draw();
        };

        const changeDirection = (newDirection) => {
          if (newDirection === "up" && direction !== "down")
            direction = newDirection;
          if (newDirection === "down" && direction !== "up")
            direction = newDirection;
          if (newDirection === "left" && direction !== "right")
            direction = newDirection;
          if (newDirection === "right" && direction !== "left")
            direction = newDirection;
        };

        // Event Listeners
        document.addEventListener("keydown", (e) => {
          if (e.key === "ArrowUp") changeDirection("up");
          if (e.key === "ArrowDown") changeDirection("down");
          if (e.key === "ArrowLeft") changeDirection("left");
          if (e.key === "ArrowRight") changeDirection("right");
        });

        document.querySelectorAll(".control-btn").forEach((button) => {
          button.addEventListener("click", () => {
            const newDirection = button.dataset.direction;
            changeDirection(newDirection);
          });
        });

        restartButton.addEventListener("click", initGame);
        window.addEventListener("resize", resizeCanvas);

        // Init
        resizeCanvas();
        initGame();
      });
    </script>
  </body>
</html>
